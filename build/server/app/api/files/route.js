(()=>{var e={};e.id=635,e.ids=[635],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5651:()=>{},5979:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9468:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>k,routeModule:()=>v,serverHooks:()=>E,workAsyncStorage:()=>R,workUnitAsyncStorage:()=>N});var r={};s.r(r),s.d(r,{DELETE:()=>y,GET:()=>j,POST:()=>h});var a=s(6639),n=s(9880),o=s(7991),i=s(1246);let l=require("fs");var p=s(3873),u=s.n(p);let c=u().join(process.cwd(),"uploads"),m=Date.now(),d=[];async function f(){try{await l.promises.access(c)}catch{await l.promises.mkdir(c,{recursive:!0})}}async function g(e){let t=u().join(c,e),s=await l.promises.stat(t);return{name:e,size:s.size,modified:s.mtime,stats:s}}function x(){m=Date.now();let e=[...d];d=[],e.forEach(e=>e.resolveFunction())}async function w(e){return e<m||new Promise(e=>{let t=setTimeout(()=>{d=d.filter(t=>t.resolveFunction!==e),e(!1)},3e4);d.push({resolveFunction:()=>{clearTimeout(t),e(!0)}})})}async function j(e){await f();let{searchParams:t}=new URL(e.url),s=t.get("fileName"),r=parseInt(t.get("since")||"0",10);if(t.has("poll")&&!s){let e=await w(r);return i.NextResponse.json({changes:e,timestamp:m})}if(s)try{let e=u().join(c,s);try{await l.promises.access(e)}catch{return i.NextResponse.json({message:"File not found"},{status:404})}let t=await l.promises.readFile(e),r="application/octet-stream",a=u().extname(s).toLowerCase(),n={".txt":"text/plain",".html":"text/html",".css":"text/css",".js":"text/javascript",".json":"application/json",".pdf":"application/pdf",".png":"image/png",".jpg":"image/jpeg",".jpeg":"image/jpeg",".gif":"image/gif",".svg":"image/svg+xml"};return n[a]&&(r=n[a]),new i.NextResponse(t,{headers:{"Content-Type":r,"Content-Disposition":`attachment; filename="${s}"`}})}catch{return console.error("Download error:"),i.NextResponse.json({message:"Error downloading file"},{status:500})}try{let e=await l.promises.readdir(c),t=(await Promise.all(e.map(async e=>{try{return await g(e)}catch{return console.error(`Error getting stats for ${e}:`),null}}))).filter(Boolean);return i.NextResponse.json({files:t,timestamp:m})}catch{return console.error("Error listing files:"),i.NextResponse.json({message:"Error listing files"},{status:500})}}async function h(e){await f();try{let t=(await e.formData()).get("file");if(!t)return i.NextResponse.json({message:"No file provided"},{status:400});let s=Buffer.from(await t.arrayBuffer()),r=t.name.replace(/[^\w\s.-]/gi,""),a=u().join(c,r);await l.promises.writeFile(a,s);let n=await g(r);return x(),i.NextResponse.json({message:"File uploaded successfully",file:n,timestamp:m})}catch(e){return console.error("Upload error:",e),i.NextResponse.json({message:"Error uploading file"},{status:500})}}async function y(e){await f();let{searchParams:t}=new URL(e.url),s=t.get("fileName");if(!s)return i.NextResponse.json({message:"No filename provided"},{status:400});try{let e=u().join(c,s);try{await l.promises.access(e)}catch{return i.NextResponse.json({message:"File not found"},{status:404})}return await l.promises.unlink(e),x(),i.NextResponse.json({message:"File deleted successfully",timestamp:m})}catch(e){return console.error("Delete error:",e),i.NextResponse.json({message:"Error deleting file"},{status:500})}}let v=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/files/route",pathname:"/api/files",filename:"route",bundlePath:"app/api/files/route"},resolvedPagePath:"/home/pantho/Desktop/cloudvault/app/api/files/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:R,workUnitAsyncStorage:N,serverHooks:E}=v;function k(){return(0,o.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:N})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[31,714],()=>s(9468));module.exports=r})();